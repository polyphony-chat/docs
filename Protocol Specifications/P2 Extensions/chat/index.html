
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../auth/">
      
      
        <link rel="next" href="../mls/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../assets/lines.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>polyproto-chat - Polyphony</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/timeago.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#p2-protocol-extension-polyproto-chat" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Polyphony" class="md-header__button md-logo" aria-label="Polyphony" data-md-component="logo">
      
  <img src="../../../assets/lines.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Polyphony
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              polyproto-chat
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/polyphony-chat/docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Overviews/core/" class="md-tabs__link">
          
  
    
  
  Overviews

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../core/" class="md-tabs__link">
          
  
    
  
  Protocol Specifications

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../APIs/" class="md-tabs__link">
          
  
    
  
  APIs

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Type%20Definitions/" class="md-tabs__link">
          
  
    
  
  Type Definitions

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Polyphony" class="md-nav__button md-logo" aria-label="Polyphony" data-md-component="logo">
      
  <img src="../../../assets/lines.png" alt="logo">

    </a>
    Polyphony
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/polyphony-chat/docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../blog/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    June 2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    November 2023
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/x509/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    X.509
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/chorus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    chorus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/polyphony/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    polyphony
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/polyproto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    polyproto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/updates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    updates
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Overviews
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Overviews
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Overviews/core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    An Overview of polyproto
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Protocol Specifications
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Protocol Specifications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    polyproto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    P2 Extensions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            P2 Extensions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    polyproto-auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    polyproto-chat
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    polyproto-chat
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#4-federating-directgroup-messages" class="md-nav__link">
    <span class="md-ellipsis">
      4. Federating direct/group messages
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Federating direct/group messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-direct-messages" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 Direct messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-group-messages" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 Group messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-encrypted-channels-and-groups" class="md-nav__link">
    <span class="md-ellipsis">
      6. Encrypted channels and groups
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Encrypted channels and groups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-encrypted-guild-channels" class="md-nav__link">
    <span class="md-ellipsis">
      6.1 Encrypted guild channels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-encrypted-direct-messages" class="md-nav__link">
    <span class="md-ellipsis">
      6.2 Encrypted direct messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-encrypted-group-messages" class="md-nav__link">
    <span class="md-ellipsis">
      6.3 Encrypted group messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-joining-new-devices-from-existing-users" class="md-nav__link">
    <span class="md-ellipsis">
      6.4 Joining new devices from existing users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#65-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      6.5 Best practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mls/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    polyproto-mls
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../APIs/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    APIs
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            APIs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../APIs/core/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Core
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../APIs/core/Routes%3A%20Registration%20needed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Routes: Registration needed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../APIs/core/Routes%3A%20No%20registration%20needed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Routes: No registration needed
  </span>
  

      </a>
    </li>
  

              
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../APIs/core/Types/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Types
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_4" id="__nav_5_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_4">
            <span class="md-nav__icon md-icon"></span>
            Types
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../APIs/core/Types/encrypted_pkm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EncryptedPKM
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../APIs/auth/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Auth
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Auth
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../APIs/auth/Routes%3A%20Registration%20needed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication Routes: Registration needed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../APIs/auth/Routes%3A%20No%20registration%20needed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication Routes: No registration needed
  </span>
  

      </a>
    </li>
  

              
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../APIs/MLS/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    MLS
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            MLS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../APIs/MLS/Routes%3A%20Registration%20needed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MLS Routes: Registration needed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../APIs/MLS/Routes%3A%20No%20registration%20needed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MLS Routes: No registration needed
  </span>
  

      </a>
    </li>
  

              
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../Type%20Definitions/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Type Definitions
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Type Definitions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Type%20Definitions/core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    polyproto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Type%20Definitions/auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    polyproto-auth
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#4-federating-directgroup-messages" class="md-nav__link">
    <span class="md-ellipsis">
      4. Federating direct/group messages
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Federating direct/group messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-direct-messages" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 Direct messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-group-messages" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 Group messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-encrypted-channels-and-groups" class="md-nav__link">
    <span class="md-ellipsis">
      6. Encrypted channels and groups
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Encrypted channels and groups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-encrypted-guild-channels" class="md-nav__link">
    <span class="md-ellipsis">
      6.1 Encrypted guild channels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-encrypted-direct-messages" class="md-nav__link">
    <span class="md-ellipsis">
      6.2 Encrypted direct messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-encrypted-group-messages" class="md-nav__link">
    <span class="md-ellipsis">
      6.3 Encrypted group messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-joining-new-devices-from-existing-users" class="md-nav__link">
    <span class="md-ellipsis">
      6.4 Joining new devices from existing users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#65-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      6.5 Best practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="p2-protocol-extension-polyproto-chat">P2 Protocol Extension: polyproto-chat<a class="headerlink" href="#p2-protocol-extension-polyproto-chat" title="Permanent link">&para;</a></h1>
<div class="admonition bug">
<p class="admonition-title">TODO</p>
<p>TODO: This is a work in progress. Chat-related content is currently being migrated over from the polyproto-core specification.
This document is not at all complete.</p>
</div>
<h2 id="4-federating-directgroup-messages">4. Federating direct/group messages<a class="headerlink" href="#4-federating-directgroup-messages" title="Permanent link">&para;</a></h2>
<h3 id="41-direct-messages">4.1 Direct messages<a class="headerlink" href="#41-direct-messages" title="Permanent link">&para;</a></h3>
<p>Federating direct messages is straightforward. When Alice sends a message to Bob, their client will send the message to Bob's home server via an API request. Bob's home server will then send the message to Bob's client via an established WebSocket connection, and vice versa.</p>
<h3 id="42-group-messages">4.2 Group messages<a class="headerlink" href="#42-group-messages" title="Permanent link">&para;</a></h3>
<p>Group messages work just like guilds, in the sense that data is stored by the home server of the group's creator, meaning that all group members will have to communicate with the group creator's home server. If the group creator leaves the group, the ownership of the group is transferred to another member. The group chat stays on the group creator's home server.</p>
<!--Potential work could be done to think of a system which allows group chat members to vote for a migration of the conversation to another server. Consent is needed from all involved parties, because otherwise, data cannot ethically be transfered from one server to another another.-->

<h2 id="6-encrypted-channels-and-groups">6. Encrypted channels and groups<a class="headerlink" href="#6-encrypted-channels-and-groups" title="Permanent link">&para;</a></h2>
<p>Note, that in the below sequence diagrams, the MLS Welcome message and the MLS Group notify message are all encrypted using the identity key of the recipient.</p>
<h3 id="61-encrypted-guild-channels">6.1 Encrypted guild channels<a class="headerlink" href="#61-encrypted-guild-channels" title="Permanent link">&para;</a></h3>
<p>Encrypting a guild channel is done by a client with the <code>MANAGE_CHANNEL</code> permission. Upon successfully requesting enabling encryption of a channel, all future messages in it will be encrypted. Joining an encrypted channel is done by sending a join request to the server. The server will then notify the channels' members of the join request. The members will then decide whether to accept or reject the join request. If the join request is accepted by any member, that member will initiate the MLS welcoming process. If the member finds that the join request is invalid (perhaps due to an invalid <code>KeyPackage</code>), the join request must be denied. It is imperative that join requests are verified correctly by the server.</p>
<p><a id="fig-3"/>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>     Charlie                                        Server                                            Alice                         Bob
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>     |                                              |                                                 |                             |
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>     | Channel join request + KeyPackage            |                                                 |                             |
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>     |---------------------------------------------&gt;|                                                 |                             |
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>     |                                              |                                                 |                             |
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>     |                                              | Notify group of join request                    |                             |
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>     |                                              |-----------------------------------              |                             |
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>     |                                              |                                  |              |                             |
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>     |                                              |&lt;----------------------------------              |                             |
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>     |                                              |                                                 |                             |
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>     |                                              | Channel join request + Charlie&#39;s KeyPackage     |                             |
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>     |                                              |------------------------------------------------&gt;|                             |
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>     |                                              |                                                 |                             |
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>     |                                              |                                                 | Verify Charlie&#39;s KeyPackage |
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>     |                                              |                                                 |------------------------     |
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>     |                                              |                                                 |                       |     |
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>     |                                              |                                                 |&lt;-----------------------     |
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>     |                                              |                                                 |                             |
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>     |                                              |             Notify group of new member: Charlie |                             |
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>     |                                              |&lt;------------------------------------------------|                             |
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>     |                                              |                                                 |                             |
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>     |                                              |                           Encrypted MLS Welcome |                             |
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>     |                                              |&lt;------------------------------------------------|                             |
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>     |                                              |                                                 |                             |
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>     |                                              | Forward: Notify group of new member: Charlie    |                             |
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>     |                                              |------------------------------------------------------------------------------&gt;|
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>     |                                              |                                                 |                             |
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>     | Forward: Notify group of new member: Charlie |                                                 |                             |
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>     |&lt;---------------------------------------------|                                                 |                             |
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>     |                                              |                                                 |                             |
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>     |               Forward: encrypted MLS Welcome |                                                 |                             |
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>     |&lt;---------------------------------------------|                                                 |                             |
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>     |                                              |                                                 |                             |
</code></pre></div>
Fig. 3: Sequence diagram of a successful encrypted channel join in which Alice acts as a gatekeeper. The sequence diagram assumes that Alice can verify Charlies' public key to indeed belong to Charlie, and that Alice accepts the join request.</p>
<h3 id="62-encrypted-direct-messages">6.2 Encrypted direct messages<a class="headerlink" href="#62-encrypted-direct-messages" title="Permanent link">&para;</a></h3>
<p>Adding another person to a direct message is not possible, and would not make much sense, as the new person cannot see any messages that were sent before they joined the group. If Alice wants to add Charlie to a direct message with Bob, she will have to create a new direct message with Bob and Charlie.</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Alice                                          Server                             Bob
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>|                                              |                                  |
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>| Request Bob&#39;s KeyPackages                    |                                  |
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>|---------------------------------------------&gt;|                                  |
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>|                                              |                                  |
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>|                            Bob&#39;s KeyPackages |                                  |
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>|&lt;---------------------------------------------|                                  |
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>|                                              |                                  |
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>| Verify Bob&#39;s KeyPackages                     |                                  |
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>| -----------------------                      |                                  |
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>|                       |                      |                                  |
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>|&lt;-----------------------                      |                                  |
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>|                                              |                                  |
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>| Notify group of new member: Bob              |                                  |
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>|---------------------------------------------&gt;|                                  |
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>|                                              |                                  |
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>| Encrypted MLS Welcome                        |                                  |
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>|---------------------------------------------&gt;|                                  |
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>|                                              |                                  |
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>|                                              | Forward: New group member: Bob   |
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>|                                              |---------------------------------&gt;|
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>|                                              |                                  |
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>|                                              | Forward encrypted MLS Welcome    |
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>|                                              |---------------------------------&gt;|
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>|                                              |                                  |
</code></pre></div>
<p>Fig. 4: Sequence diagram of a successful encrypted direct message creation.</p>
<h3 id="63-encrypted-group-messages">6.3 Encrypted group messages<a class="headerlink" href="#63-encrypted-group-messages" title="Permanent link">&para;</a></h3>
<p>Encrypted group messages work by using the traditional MLS protocol, with the additional concept of group owners. Only group owners can add new members to the group and forcibly remove others from the group. The Group owner is determined by the Client-Server API.</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>Alice (gatekeeper)                                 Server                                  Bob       Charlie
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>|                                                  |                                       |         |
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>| Request Bob&#39;s KeyPackages                        |                                       |         |
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>|-------------------------------------------------&gt;|                                       |         |
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>|                                                  |                                       |         |
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>|                                Bob&#39;s KeyPackages |                                       |         |
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>|&lt;-------------------------------------------------|                                       |         |
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>|                                                  |                                       |         |
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>| Verify Bob&#39;s KeyPackages                         |                                       |         |
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>|------------------------                          |                                       |         |
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>|                       |                          |                                       |         |
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>|&lt;-----------------------                          |                                       |         |
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>|                                                  |                                       |         |
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>| Notify group of new member: Bob                  |                                       |         |
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>|-------------------------------------------------&gt;|                                       |         |
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>|                                                  |                                       |         |
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>| Encrypted MLS Welcome                            |                                       |         |
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>|-------------------------------------------------&gt;|                                       |         |
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>|                                                  |                                       |         |
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>|                                                  | Forward: New group member: Bob        |         |
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>|                                                  |--------------------------------------&gt;|         |
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>|                                                  |                                       |         |
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>|                                                  | Forward encrypted MLS Welcome         |         |
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>|                                                  |--------------------------------------&gt;|         |
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>|                                                  |                                       |         |
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>| Request Charlie&#39;s KeyPackages                    |                                       |         |
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>|-------------------------------------------------&gt;|                                       |         |
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>|                                                  |                                       |         |
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>|                            Charlie&#39;s KeyPackages |                                       |         |
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>|&lt;-------------------------------------------------|                                       |         |
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>|                                                  |                                       |         |
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>| Verify Charlie&#39;s KeyPackages                     |                                       |         |
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>|----------------------------                      |                                       |         |
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>|                           |                      |                                       |         |
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>|&lt;---------------------------                      |                                       |         |
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>|                                                  |                                       |         |
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>| Notify group of new member: Charlie              |                                       |         |
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>|-------------------------------------------------&gt;|                                       |         |
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>|                                                  |                                       |         |
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>| Encrypted MLS Welcome                            |                                       |         |
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a>|-------------------------------------------------&gt;|                                       |         |
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>|                                                  |                                       |         |
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a>|                                                  | Forward: New group member: Charlie    |         |
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a>|                                                  |--------------------------------------&gt;|         |
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a>|                                                  |                                       |         |
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a>|                                                  | Forward: New group member: Charlie    |         |
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a>|                                                  |------------------------------------------------&gt;|
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a>|                                                  |                                       |         |
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a>|                                                  | Forward encrypted MLS Welcome         |         |
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a>|                                                  |------------------------------------------------&gt;|
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a>|                                                  |                                       |         |
</code></pre></div>
<p>Fig. 5: Sequence diagram of a successful encrypted group creation with 3 members.</p>
<h3 id="64-joining-new-devices-from-existing-users">6.4 Joining new devices from existing users<a class="headerlink" href="#64-joining-new-devices-from-existing-users" title="Permanent link">&para;</a></h3>
<p>Regardless of channel or group permissions, a user join request from a new device should be accepted by default.</p>
<h3 id="65-best-practices">6.5 Best practices<a class="headerlink" href="#65-best-practices" title="Permanent link">&para;</a></h3>
<ul>
<li>In case of encrypted guild channel join requests, it may be a good idea to treat multiple join requests from the same user with different clients as a single join request, when it comes to UI/UX.</li>
<li>Joining an encrypted channel, even from an already established member with a new device, should be an event distinctly visible to all members of the channel. This is to prevent a malicious user from joining a channel without the other members noticing.</li>
</ul>
<hr />
<ul>
<li><strong>Actor</strong> - An entity represented by a federation ID, registered on a home server. Actors can be
  users, bots, or any other entity with a federation ID.</li>
<li><strong>CA, Certificate Authority</strong> - Any home server that issues and publicly attests to the validity
  of ID-Certs. In polyproto, only home servers are CAs.</li>
<li><strong>Client</strong> - Any application used by an actor to connect to an instance.</li>
<li><strong>CSR, Certificate Signing Request</strong> - A request sent to a CA to obtain a certificate. It holds
  information about the entity requesting the certificate, including their public identity key.</li>
<li><strong>DN, Distinguished Name</strong> - A set of RDNs (Relative Distinguished Names) that uniquely identify
  a certificate. See <a href="https://ldap.com/ldap-dns-and-rdns/">https://ldap.com/ldap-dns-and-rdns/</a></li>
<li><strong>Federation ID</strong> - A unique identifier; In public contexts, usually <strong>actor@</strong>subdomain.<strong>example</strong>.com,
  where bold parts are required and non-bold parts are optional.</li>
<li><strong>Foreign server</strong> - An instance that an actor is not registered on; essentially a third party.</li>
<li><strong>Home server</strong> - The instance that an actor is registered on. Any polyproto-core compliant server
  hosted on the same domain is also considered a home server. A home server is the instance that
  publicly attests to the validity of all legitimate ID-Certs issued under its <a href="https://en.wikipedia.org/wiki/Fully_qualified_domain_name">FQDN</a>.
  A domain can have many home servers, but only one per subdomain.</li>
<li><strong>ID-CSR</strong> - A certificate signing request for a client's identity key pair. It is used to obtain
  an ID-Cert.</li>
<li><strong>Identity</strong> - Synonymous with "Federation ID".</li>
<li><strong>Identity Key Pair</strong> - A key pair associating an identity with a set of cryptographic keys used
  to sign and possibly encrypt messages.</li>
<li><strong>Instance</strong> - A server hosting polyproto compliant software for clients.</li>
<li>
<p><strong>Message, Messages</strong>: In the context of this protocol specification, a <strong>message</strong> is any piece
  of data sent by a client that is intended to be identifiable as being sent by a specific actor.
  To qualify as a "message", this piece of data must also, at any point in time, and also if only
  briefly, be visible to other users or to the unauthenticated public. Examples of things that would
  qualify as messages include:</p>
<ul>
<li>A message sent to another actor in a chat application</li>
<li>A post on a social media platform</li>
<li>A "like" interaction on a social media platform</li>
<li>Reaction emojis in Discord-like chat applications</li>
<li>Group join or leave messages</li>
<li>Reporting a post or actor, if the report is not anonymous</li>
</ul>
</li>
<li>
<p><strong>P2</strong> - Shortened form of polyproto.</p>
</li>
<li><strong>P2 Extension</strong> - A polyproto extension.</li>
<li><strong>polyproto-chat</strong> - The chat-API used by Polyphony. An extension of the polyproto protocol,
  defining the routes and capabilities of the chat-API used by Polyphony.</li>
<li><strong>polyproto</strong> - The core federation protocol and APIs of polyproto, enabling identification and
  authorization on foreign servers. It is independent of the chat-API used.</li>
<li><strong>Root Certificate</strong> - A certificate used to sign other certificates, establishing a chain of
  trust. In polyproto, only home servers have root certificates.</li>
<li><strong>Service</strong>: Any application-specific implementation of polyproto, defined by a P2 extension.
  All services are P2 extensions, but not all P2 extensions are services. polyproto-chat is an
  example of a service.</li>
<li><strong>Session</strong> - A specific period of authenticated interaction between a client and an instance.
  During the lifetime of a session, the client can perform actions as the actor they are authenticated
  as.</li>
<li><strong>Session ID</strong> - <a href="/Protocol%20Specifications/core#6113-session-ids">See polyproto specification: Section 6.1.1.3</a></li>
</ul>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-06-03T10:43:50+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-06-03</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2023-12-23T17:48:43+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-12-23</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "toc.follow", "navigation.top", "search.suggest", "content.tooltips", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
        <script src="../../../js/timeago.min.js"></script>
      
        <script src="../../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../../assets/external/unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
    
  </body>
</html>